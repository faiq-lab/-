<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cart & Checkout</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            --success-gradient: linear-gradient(135deg, #10b981 0%, #059669 100%);
            --warning-gradient: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            --danger-gradient: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            --dark-color: #0f172a;
            --light-color: #f8fafc;
            --glass-bg: rgba(255, 255, 255, 0.98);
            --glass-border: rgba(255, 255, 255, 0.2);
            --shadow-lg: 0 20px 60px rgba(0,0,0,0.15);
            --shadow-md: 0 10px 30px rgba(0,0,0,0.1);
            --border-radius-lg: 24px;
            --border-radius-md: 16px;
            --border-radius-sm: 12px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
            color: var(--dark-color);
            min-height: 100vh;
        }
        
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            padding: 25px;
            margin-bottom: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .glass-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }
        
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            position: relative;
            padding: 0 20px;
        }
        
        .step-indicator::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 50px;
            right: 50px;
            height: 3px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            z-index: 1;
        }
        
        .step {
            background: white;
            border: 3px solid #e2e8f0;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            position: relative;
            z-index: 2;
            color: #64748b;
            transition: all 0.3s ease;
        }
        
        .step.active {
            border-color: #667eea;
            background: var(--primary-gradient);
            color: white;
            transform: scale(1.1);
        }
        
        .step.completed {
            border-color: #10b981;
            background: var(--success-gradient);
            color: white;
        }
        
        .step-label {
            position: absolute;
            top: 55px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
            white-space: nowrap;
        }
        
        .step.active .step-label {
            color: #667eea;
            font-weight: 700;
        }
        
        .checkout-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .checkout-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .payment-method {
            border: 2px solid #e2e8f0;
            border-radius: var(--border-radius-sm);
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .payment-method:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .payment-method.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }
        
        .delivery-option {
            border: 2px solid #e2e8f0;
            border-radius: var(--border-radius-sm);
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }
        
        .delivery-option:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .delivery-option.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }
        
        .cart-item {
            display: flex;
            align-items: center;
            padding: 20px;
            background: white;
            border-radius: var(--border-radius-md);
            margin-bottom: 15px;
            box-shadow: var(--shadow-md);
            border: 1px solid #f1f5f9;
        }
        
        .cart-item-image {
            width: 100px;
            height: 100px;
            border-radius: var(--border-radius-sm);
            object-fit: cover;
            margin-right: 20px;
            background: #f8fafc;
            padding: 10px;
        }
        
        .quantity-control {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f8fafc;
            padding: 8px;
            border-radius: var(--border-radius-sm);
            border: 1px solid #e2e8f0;
        }
        
        .quantity-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            border: 2px solid #e2e8f0;
            background: white;
            color: var(--dark-color);
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .quantity-btn:hover {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }
        
        .btn-gradient {
            background: var(--primary-gradient);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
            color: white;
        }
        
        .btn-success-gradient {
            background: var(--success-gradient);
            color: white;
            border: none;
            border-radius: var(--border-radius-sm);
            padding: 12px 24px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .btn-success-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);
            color: white;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f1f5f9;
        }
        
        .summary-total {
            border-bottom: none;
            border-top: 2px solid #f1f5f9;
            font-size: 1.2em;
            font-weight: 700;
            color: var(--dark-color);
            padding-top: 15px;
            margin-top: 10px;
        }
        
        #map {
            height: 300px;
            width: 100%;
            border-radius: var(--border-radius-md);
            margin-top: 15px;
            border: 2px solid #e2e8f0;
        }
        
        .card-logos {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }
        
        .card-logo {
            width: 60px;
            height: 40px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 700;
            color: white;
        }
        
        .card-logo.visa { background: #1a1f71; }
        .card-logo.mastercard { background: #eb001b; }
        .card-logo.amex { background: #2e77bc; }
        .card-logo.discover { background: #ff6000; }
        
        .form-control {
            border: 2px solid #e2e8f0;
            border-radius: var(--border-radius-sm);
            padding: 12px 15px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .order-summary-card {
            position: sticky;
            top: 20px;
            background: white;
            border-radius: var(--border-radius-lg);
            padding: 25px;
            box-shadow: var(--shadow-lg);
            border: 1px solid #f1f5f9;
        }
        
        @media (max-width: 768px) {
            .step-indicator::before {
                left: 40px;
                right: 40px;
            }
            
            .step {
                width: 40px;
                height: 40px;
                font-size: 14px;
            }
            
            .step-label {
                font-size: 11px;
                top: 50px;
            }
            
            .cart-item {
                flex-direction: column;
                text-align: center;
            }
            
            .cart-item-image {
                margin-right: 0;
                margin-bottom: 15px;
            }
            
            .order-summary-card {
                position: static;
                margin-top: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container py-4">
        <!-- Header -->
        <header class="mb-4">
            <div class="d-flex justify-content-between align-items-center">
                <h1 class="h3 mb-0 fw-800">
                    <i class="fas fa-shopping-cart text-primary me-2"></i>
                    Your Shopping Cart
                </h1>
                <a href="index.html" class="btn btn-outline-primary">
                    <i class="fas fa-arrow-left me-2"></i> Continue Shopping
                </a>
            </div>
        </header>

        <!-- Progress Steps -->
        <div class="glass-card">
            <div class="step-indicator">
                <div class="step active" data-step="1">
                    <span>1</span>
                    <div class="step-label">Cart</div>
                </div>
                <div class="step" data-step="2">
                    <span>2</span>
                    <div class="step-label">Address</div>
                </div>
                <div class="step" data-step="3">
                    <span>3</span>
                    <div class="step-label">Delivery</div>
                </div>
                <div class="step" data-step="4">
                    <span>4</span>
                    <div class="step-label">Payment</div>
                </div>
                <div class="step" data-step="5">
                    <span>5</span>
                    <div class="step-label">Confirm</div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="row">
            <!-- Left Column: Checkout Process -->
            <div class="col-lg-8">
                <!-- Section 1: Cart Items -->
                <div id="cart-section" class="checkout-section active glass-card">
                    <h3 class="mb-4 fw-800">
                        <i class="fas fa-shopping-bag text-primary me-2"></i>
                        Your Items
                    </h3>
                    
                    <div id="cart-items-container">
                        <!-- Cart items will be dynamically loaded here -->
                        <div class="text-center py-5">
                            <i class="fas fa-shopping-cart fa-3x text-muted mb-3"></i>
                            <p class="text-muted">Your cart is empty</p>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between mt-4">
                        <button class="btn btn-outline-secondary" onclick="window.history.back()">
                            <i class="fas fa-arrow-left me-2"></i> Go Back
                        </button>
                        <button class="btn-gradient" onclick="nextStep(2)">
                            Next: Address <i class="fas fa-arrow-right ms-2"></i>
                        </button>
                    </div>
                </div>

                <!-- Section 2: Address Verification -->
                <div id="address-section" class="checkout-section glass-card">
                    <h3 class="mb-4 fw-800">
                        <i class="fas fa-map-marker-alt text-primary me-2"></i>
                        Delivery Address
                    </h3>
                    
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-600">Full Name</label>
                                <input type="text" class="form-control" id="full-name" placeholder="Enter your full name">
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label fw-600">Phone Number</label>
                                <input type="tel" class="form-control" id="phone-number" placeholder="+1 (123) 456-7890">
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label fw-600">Email Address</label>
                                <input type="email" class="form-control" id="email-address" placeholder="you@example.com">
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label fw-600">Postal Code</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="postal-code" placeholder="Enter postal code">
                                    <button class="btn btn-outline-primary" type="button" onclick="verifyPostalCode()">
                                        Verify
                                    </button>
                                </div>
                                <div class="form-text" id="postal-code-status"></div>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label fw-600">Complete Address</label>
                                <textarea class="form-control" id="full-address" rows="3" 
                                          placeholder="House number, street, apartment, city"></textarea>
                            </div>
                            
                            <div class="mb-3">
                                <label class="form-label fw-600">City</label>
                                <select class="form-control" id="city">
                                    <option value="">Select City</option>
                                    <option value="new-york">New York</option>
                                    <option value="london">London</option>
                                    <option value="dubai">Dubai</option>
                                    <option value="toronto">Toronto</option>
                                    <option value="sydney">Sydney</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Map Integration -->
                    <div class="mb-3">
                        <label class="form-label fw-600">
                            <i class="fas fa-map-pin text-primary me-2"></i>
                            Select Location (Optional)
                        </label>
                        <div class="input-group mb-2">
                            <input type="text" class="form-control" id="location-search" placeholder="Search for location...">
                            <button class="btn btn-outline-primary" onclick="locateUser()">
                                <i class="fas fa-location-arrow me-2"></i> Use My Location
                            </button>
                        </div>
                        <div id="map"></div>
                    </div>
                    
                    <div class="alert alert-warning" id="address-alert" style="display: none;">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        Please fill all required address fields correctly.
                    </div>
                    
                    <div class="d-flex justify-content-between mt-4">
                        <button class="btn btn-outline-secondary" onclick="prevStep(1)">
                            <i class="fas fa-arrow-left me-2"></i> Back to Cart
                        </button>
                        <button class="btn-gradient" onclick="verifyAddressAndNext()">
                            Verify & Continue <i class="fas fa-arrow-right ms-2"></i>
                        </button>
                    </div>
                </div>

                <!-- Section 3: Delivery Options -->
                <div id="delivery-section" class="checkout-section glass-card">
                    <h3 class="mb-4 fw-800">
                        <i class="fas fa-shipping-fast text-primary me-2"></i>
                        Delivery Options
                    </h3>
                    
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body">
                                    <h5 class="card-title fw-700">
                                        <i class="fas fa-map-marker-alt text-primary me-2"></i>
                                        Selected Address
                                    </h5>
                                    <p class="card-text" id="selected-address-display">No address selected</p>
                                    <p class="card-text">
                                        <small class="text-muted" id="distance-display">Distance: Calculating...</small>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body">
                                    <h5 class="card-title fw-700">
                                        <i class="fas fa-box text-primary me-2"></i>
                                        Order Details
                                    </h5>
                                    <div class="summary-item">
                                        <span>Items:</span>
                                        <span id="item-count">0</span>
                                    </div>
                                    <div class="summary-item">
                                        <span>Weight:</span>
                                        <span id="total-weight">0 kg</span>
                                    </div>
                                    <div class="summary-item">
                                        <span>Subtotal:</span>
                                        <span id="total-price-display">$0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <h5 class="mb-3 fw-700">Select Delivery Method</h5>
                    
                    <div class="delivery-option" onclick="selectDeliveryOption('standard')">
                        <div class="form-check mb-0">
                            <input class="form-check-input" type="radio" name="deliveryOption" id="standard-delivery">
                            <label class="form-check-label w-100" for="standard-delivery">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>Standard Delivery</strong>
                                        <p class="mb-0 text-muted">5-7 business days</p>
                                    </div>
                                    <div>
                                        <strong id="standard-price">$9.99</strong>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <div class="delivery-option" onclick="selectDeliveryOption('express')">
                        <div class="form-check mb-0">
                            <input class="form-check-input" type="radio" name="deliveryOption" id="express-delivery">
                            <label class="form-check-label w-100" for="express-delivery">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>Express Delivery</strong>
                                        <p class="mb-0 text-muted">2-3 business days</p>
                                    </div>
                                    <div>
                                        <strong id="express-price">$19.99</strong>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <div class="delivery-option" onclick="selectDeliveryOption('same-day')">
                        <div class="form-check mb-0">
                            <input class="form-check-input" type="radio" name="deliveryOption" id="same-day-delivery">
                            <label class="form-check-label w-100" for="same-day-delivery">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong>Same Day Delivery</strong>
                                        <p class="mb-0 text-muted">Within 24 hours</p>
                                    </div>
                                    <div>
                                        <strong id="same-day-price">$29.99</strong>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <div class="alert alert-info mt-3">
                        <i class="fas fa-info-circle me-2"></i>
                        Delivery charges are calculated based on distance, package weight, and selected service.
                    </div>
                    
                    <div class="d-flex justify-content-between mt-4">
                        <button class="btn btn-outline-secondary" onclick="prevStep(2)">
                            <i class="fas fa-arrow-left me-2"></i> Back to Address
                        </button>
                        <button class="btn-gradient" onclick="calculateDeliveryAndNext()">
                            Confirm Delivery <i class="fas fa-arrow-right ms-2"></i>
                        </button>
                    </div>
                </div>

                <!-- Section 4: Payment Gateway -->
                <div id="payment-section" class="checkout-section glass-card">
                    <h3 class="mb-4 fw-800">
                        <i class="fas fa-credit-card text-primary me-2"></i>
                        Payment Method
                    </h3>
                    
                    <!-- Country Detection -->
                    <div class="alert alert-info mb-4">
                        <i class="fas fa-globe-americas me-2"></i>
                        Your Country: <span id="user-country" class="fw-700">United States</span> | 
                        Available Methods: 
                        <span id="available-methods" class="fw-700">Credit/Debit Card, PayPal, Apple Pay</span>
                    </div>
                    
                    <!-- Credit/Debit Card -->
                    <div class="payment-method" onclick="selectPaymentMethod('card')">
                        <div class="form-check mb-0">
                            <input class="form-check-input" type="radio" name="paymentMethod" id="credit-card">
                            <label class="form-check-label w-100" for="credit-card">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong><i class="fas fa-credit-card me-2"></i>Credit / Debit Card</strong>
                                        <p class="mb-0 text-muted">International Cards (Visa, MasterCard, Amex, Discover)</p>
                                    </div>
                                    <div class="card-logos">
                                        <div class="card-logo visa">VISA</div>
                                        <div class="card-logo mastercard">MC</div>
                                        <div class="card-logo amex">AMEX</div>
                                        <div class="card-logo discover">DISC</div>
                                    </div>
                                </div>
                            </label>
                        </div>
                        
                        <!-- Card Details Form -->
                        <div id="card-details" style="display: none; margin-top: 20px;">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label fw-600">Card Number</label>
                                        <input type="text" class="form-control" id="card-number" 
                                               placeholder="1234 5678 9012 3456" maxlength="19">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label fw-600">Expiry Date</label>
                                        <input type="text" class="form-control" id="card-expiry" 
                                               placeholder="MM/YY" maxlength="5">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label fw-600">CVV</label>
                                        <input type="text" class="form-control" id="card-cvv" 
                                               placeholder="123" maxlength="4">
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label fw-600">Cardholder Name</label>
                                <input type="text" class="form-control" id="card-holder" 
                                       placeholder="As shown on card">
                            </div>
                            <div class="alert alert-warning">
                                <small><i class="fas fa-lock me-2"></i>Your payment information is securely processed.</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- PayPal -->
                    <div class="payment-method" onclick="selectPaymentMethod('paypal')">
                        <div class="form-check mb-0">
                            <input class="form-check-input" type="radio" name="paymentMethod" id="paypal-payment">
                            <label class="form-check-label w-100" for="paypal-payment">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong><i class="fab fa-paypal me-2"></i>PayPal</strong>
                                        <p class="mb-0 text-muted">Fast and secure online payments</p>
                                    </div>
                                    <div>
                                        <i class="fab fa-paypal fa-2x" style="color: #003087;"></i>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Apple Pay -->
                    <div class="payment-method" onclick="selectPaymentMethod('applepay')">
                        <div class="form-check mb-0">
                            <input class="form-check-input" type="radio" name="paymentMethod" id="apple-pay">
                            <label class="form-check-label w-100" for="apple-pay">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong><i class="fab fa-apple-pay me-2"></i>Apple Pay</strong>
                                        <p class="mb-0 text-muted">Pay with Apple devices</p>
                                    </div>
                                    <div>
                                        <i class="fab fa-apple-pay fa-2x"></i>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Google Pay -->
                    <div class="payment-method" onclick="selectPaymentMethod('googlepay')">
                        <div class="form-check mb-0">
                            <input class="form-check-input" type="radio" name="paymentMethod" id="google-pay">
                            <label class="form-check-label w-100" for="google-pay">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div>
                                        <strong><i class="fab fa-google-pay me-2"></i>Google Pay</strong>
                                        <p class="mb-0 text-muted">Pay with Google account</p>
                                    </div>
                                    <div>
                                        <i class="fab fa-google-pay fa-2x" style="color: #4285F4;"></i>
                                    </div>
                                </div>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Bank Transfer -->
                    <div class="payment-method" onclick="selectPaymentMethod('bank')">
                        <div class="form-check mb-0">
                            <input class="form-check-input" type="radio" name="paymentMethod" id="bank-transfer">
                            <label class="form-check-label w-100" for="bank-transfer">
                                <strong><i class="fas fa-university me-2"></i>Bank Transfer</strong>
                                <p class="mb-0 text-muted">Direct bank transfer or wire transfer</p>
                            </label>
                        </div>
                        
                        <div id="bank-details" style="display: none; margin-top: 20px;">
                            <div class="alert alert-info">
                                <h6 class="alert-heading fw-700">Bank Details:</h6>
                                <p class="mb-1">Bank Name: Chase Bank</p>
                                <p class="mb-1">Account Number: 1234567890</p>
                                <p class="mb-1">Account Name: Your Store Name</p>
                                <p class="mb-1">Routing Number: 021000021</p>
                                <p class="mb-1">SWIFT/BIC: CHASUS33</p>
                                <small>Please send payment receipt after transaction.</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Cash on Delivery -->
                    <div class="payment-method" onclick="selectPaymentMethod('cod')">
                        <div class="form-check mb-0">
                            <input class="form-check-input" type="radio" name="paymentMethod" id="cash-delivery">
                            <label class="form-check-label w-100" for="cash-delivery">
                                <strong><i class="fas fa-money-bill-wave me-2"></i>Cash on Delivery (COD)</strong>
                                <p class="mb-0 text-muted">Pay when you receive the items</p>
                            </label>
                        </div>
                        
                        <div id="cod-info" style="display: none; margin-top: 20px;">
                            <div class="alert alert-warning">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                <strong>Note:</strong> 
                                COD may not be available in all areas. Additional COD fee may apply.
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-success mt-3">
                        <i class="fas fa-shield-alt me-2"></i>
                        All payments are secured with SSL encryption and 256-bit security.
                    </div>
                    
                    <div class="d-flex justify-content-between mt-4">
                        <button class="btn btn-outline-secondary" onclick="prevStep(3)">
                            <i class="fas fa-arrow-left me-2"></i> Back to Delivery
                        </button>
                        <button class="btn-success-gradient" onclick="processPayment()">
                            <i class="fas fa-lock me-2"></i> Complete Payment
                        </button>
                    </div>
                </div>

                <!-- Section 5: Order Confirmation -->
                <div id="confirmation-section" class="checkout-section glass-card">
                    <div class="text-center py-5">
                        <div class="mb-4">
                            <i class="fas fa-check-circle fa-5x text-success"></i>
                        </div>
                        <h2 class="text-success fw-800">Order Confirmed!</h2>
                        <p class="lead">Your Order Number: <strong id="order-number" class="text-dark">ORD-123456</strong></p>
                        
                        <div class="card mx-auto mt-4 border-0 shadow-sm" style="max-width: 600px;">
                            <div class="card-body">
                                <h5 class="card-title fw-700">
                                    <i class="fas fa-receipt text-primary me-2"></i>
                                    Order Details
                                </h5>
                                <div class="text-start">
                                    <div class="summary-item">
                                        <span>Address:</span>
                                        <span id="confirmed-address" class="fw-600">Not set</span>
                                    </div>
                                    <div class="summary-item">
                                        <span>Delivery:</span>
                                        <span id="confirmed-delivery" class="fw-600">Not selected</span>
                                    </div>
                                    <div class="summary-item">
                                        <span>Payment:</span>
                                        <span id="confirmed-payment" class="fw-600">Not selected</span>
                                    </div>
                                    <div class="summary-item">
                                        <span>Total Amount:</span>
                                        <span id="confirmed-total" class="fw-600">$0.00</span>
                                    </div>
                                    <div class="summary-item">
                                        <span>Estimated Delivery:</span>
                                        <span id="estimated-delivery" class="fw-600">Calculating...</span>
                                    </div>
                                    <div class="summary-item">
                                        <span>Tracking Number:</span>
                                        <span id="tracking-number" class="fw-600 text-primary">TRK-7890123456</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <p class="text-muted">
                                We'll send you order updates via email and SMS.
                            </p>
                            <div class="d-flex justify-content-center gap-3 mt-4 flex-wrap">
                                <button class="btn btn-outline-primary" onclick="printOrder()">
                                    <i class="fas fa-print me-2"></i> Print Receipt
                                </button>
                                <button class="btn btn-primary" onclick="trackOrder()">
                                    <i class="fas fa-shipping-fast me-2"></i> Track Order
                                </button>
                                <a href="index.html" class="btn btn-success-gradient">
                                    <i class="fas fa-home me-2"></i> Return to Home
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Column: Order Summary -->
            <div class="col-lg-4">
                <div class="order-summary-card">
                    <div class="card-header bg-transparent border-0 pb-0">
                        <h4 class="fw-800">
                            <i class="fas fa-clipboard-list text-primary me-2"></i>
                            Order Summary
                        </h4>
                    </div>
                    <div class="card-body p-0 pt-3">
                        <div id="order-summary-items">
                            <!-- Order items will be dynamically loaded -->
                            <div class="summary-item">
                                <span>Items:</span>
                                <span>0</span>
                            </div>
                        </div>
                        
                        <div class="summary-item">
                            <span>Subtotal:</span>
                            <span id="subtotal">$0.00</span>
                        </div>
                        
                        <div class="summary-item">
                            <span>Tax (10%):</span>
                            <span id="tax">$0.00</span>
                        </div>
                        
                        <div class="summary-item">
                            <span>Shipping:</span>
                            <span id="delivery-charge">$0.00</span>
                        </div>
                        
                        <div class="summary-item summary-total">
                            <span>Total:</span>
                            <span id="grand-total" class="text-success fw-800">$0.00</span>
                        </div>
                        
                        <div class="alert alert-light mt-3">
                            <small>
                                <i class="fas fa-sync-alt me-2"></i>
                                Total amount updates automatically based on delivery method and address.
                            </small>
                        </div>
                        
                        <div class="d-grid gap-2 mt-3">
                            <button class="btn-success-gradient btn-lg" onclick="placeOrder()" id="place-order-btn" disabled>
                                <i class="fas fa-shopping-bag me-2"></i> Place Order
                            </button>
                        </div>
                    </div>
                    
                    <!-- Delivery Partners -->
                    <div class="mt-4">
                        <h6 class="fw-700 mb-3">
                            <i class="fas fa-truck text-primary me-2"></i>
                            Delivery Partners
                        </h6>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="fw-600">FedEx</span>
                            <i class="fas fa-shipping-fast text-warning"></i>
                        </div>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="fw-600">UPS</span>
                            <i class="fas fa-box text-primary"></i>
                        </div>
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="fw-600">DHL</span>
                            <i class="fas fa-globe text-success"></i>
                        </div>
                    </div>
                    
                    <!-- Support -->
                    <div class="mt-4 pt-3 border-top">
                        <h6 class="fw-700">
                            <i class="fas fa-headset text-primary me-2"></i>
                            Need Help?
                        </h6>
                        <p class="text-muted">
                            Our customer support team is here to assist you.
                        </p>
                        <a href="tel:+1234567890" class="btn btn-outline-primary btn-sm w-100">
                            <i class="fas fa-phone me-2"></i> +1 (234) 567-890
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&libraries=places"></script>
    
    <script>
        // Global Variables
        let currentStep = 1;
        let cartItems = [];
        let selectedAddress = null;
        let selectedDelivery = null;
        let selectedPayment = null;
        let orderTotal = 0;
        let map;
        let marker;
        let userCountry = 'US';
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadCartItems();
            initializeMap();
            detectUserCountry();
            updatePaymentMethods();
            updateOrderSummary();
            updateStepIndicators();
        });
        
        // Step Navigation
        function nextStep(step) {
            if (validateCurrentStep()) {
                document.querySelectorAll('.checkout-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                document.querySelectorAll('.step').forEach(s => {
                    s.classList.remove('active');
                });
                
                currentStep = step;
                document.getElementById(getSectionId(step)).classList.add('active');
                document.querySelector(`.step[data-step="${step}"]`).classList.add('active');
                
                updateStepIndicators();
                
                if (step === 2) {
                    loadAddressSection();
                } else if (step === 3) {
                    loadDeliverySection();
                } else if (step === 4) {
                    loadPaymentSection();
                }
            }
        }
        
        function prevStep(step) {
            document.querySelectorAll('.checkout-section').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.step').forEach(s => {
                s.classList.remove('active');
            });
            
            currentStep = step;
            document.getElementById(getSectionId(step)).classList.add('active');
            document.querySelector(`.step[data-step="${step}"]`).classList.add('active');
            
            updateStepIndicators();
        }
        
        function getSectionId(step) {
            const sections = {
                1: 'cart-section',
                2: 'address-section',
                3: 'delivery-section',
                4: 'payment-section',
                5: 'confirmation-section'
            };
            return sections[step] || 'cart-section';
        }
        
        function updateStepIndicators() {
            document.querySelectorAll('.step').forEach((step, index) => {
                const stepNumber = index + 1;
                if (stepNumber < currentStep) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (stepNumber === currentStep) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            });
        }
        
        // Cart Management
        function loadCartItems() {
            // Sample cart data - in production, load from localStorage/API
            cartItems = JSON.parse(localStorage.getItem('cart')) || [
                {
                    id: 1,
                    name: 'Premium Smartphone',
                    price: 899.99,
                    quantity: 1,
                    weight: 0.3,
                    image: 'https://images.unsplash.com/photo-1598327105666-5b89351aff97?w=400&h=400&fit=crop'
                },
                {
                    id: 2,
                    name: 'Wireless Headphones',
                    price: 199.99,
                    quantity: 2,
                    weight: 0.2,
                    image: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=400&h=400&fit=crop'
                }
            ];
            
            updateCartDisplay();
        }
        
        function updateCartDisplay() {
            const container = document.getElementById('cart-items-container');
            
            if (cartItems.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-shopping-cart fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted mb-2">Your cart is empty</h5>
                        <p class="text-muted">Add items to get started</p>
                        <a href="index.html" class="btn btn-primary mt-2">
                            <i class="fas fa-shopping-bag me-2"></i> Start Shopping
                        </a>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            
            cartItems.forEach(item => {
                const itemElement = document.createElement('div');
                itemElement.className = 'cart-item';
                itemElement.innerHTML = `
                    <img src="${item.image}" alt="${item.name}" class="cart-item-image">
                    <div class="flex-grow-1">
                        <h6 class="fw-700 mb-1">${item.name}</h6>
                        <p class="text-muted mb-2">$${item.price.toFixed(2)} each</p>
                        <div class="quantity-control d-inline-flex">
                            <button class="quantity-btn" onclick="updateQuantity(${item.id}, -1)">-</button>
                            <input type="number" class="quantity-input form-control text-center" 
                                   value="${item.quantity}" min="1" 
                                   onchange="updateQuantity(${item.id}, 0, this.value)">
                            <button class="quantity-btn" onclick="updateQuantity(${item.id}, 1)">+</button>
                        </div>
                    </div>
                    <div class="text-end">
                        <h6 class="fw-800 mb-2">$${(item.price * item.quantity).toFixed(2)}</h6>
                        <button class="btn btn-link text-danger p-0" onclick="removeItem(${item.id})">
                            <i class="fas fa-trash me-1"></i> Remove
                        </button>
                    </div>
                `;
                container.appendChild(itemElement);
            });
            
            updateOrderSummary();
        }
        
        function updateQuantity(itemId, change, newValue = null) {
            const item = cartItems.find(i => i.id === itemId);
            if (item) {
                if (newValue !== null) {
                    const val = parseInt(newValue);
                    item.quantity = isNaN(val) || val < 1 ? 1 : val;
                } else {
                    item.quantity += change;
                    if (item.quantity < 1) item.quantity = 1;
                }
                updateCartDisplay();
                saveCart();
            }
        }
        
        function removeItem(itemId) {
            if (confirm('Are you sure you want to remove this item?')) {
                cartItems = cartItems.filter(item => item.id !== itemId);
                updateCartDisplay();
                saveCart();
            }
        }
        
        function saveCart() {
            localStorage.setItem('cart', JSON.stringify(cartItems));
        }
        
        // Address Management
        function initializeMap() {
            const defaultLocation = { lat: 40.7128, lng: -74.0060 }; // New York
            
            map = new google.maps.Map(document.getElementById('map'), {
                center: defaultLocation,
                zoom: 12,
                mapTypeControl: true,
                streetViewControl: false,
                fullscreenControl: true,
                styles: [
                    {
                        featureType: "all",
                        elementType: "geometry",
                        stylers: [{ color: "#f5f5f5" }]
                    }
                ]
            });
            
            marker = new google.maps.Marker({
                map: map,
                draggable: true,
                animation: google.maps.Animation.DROP,
                position: defaultLocation,
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 10,
                    fillColor: "#667eea",
                    fillOpacity: 1,
                    strokeColor: "#ffffff",
                    strokeWeight: 2
                }
            });
            
            // Add search box
            const input = document.getElementById('location-search');
            const searchBox = new google.maps.places.SearchBox(input);
            
            map.addListener('bounds_changed', function() {
                searchBox.setBounds(map.getBounds());
            });
            
            searchBox.addListener('places_changed', function() {
                const places = searchBox.getPlaces();
                if (places.length === 0) return;
                
                const place = places[0];
                if (!place.geometry) return;
                
                map.setCenter(place.geometry.location);
                marker.setPosition(place.geometry.location);
                
                document.getElementById('full-address').value = place.formatted_address || '';
                
                place.address_components.forEach(component => {
                    if (component.types.includes('postal_code')) {
                        document.getElementById('postal-code').value = component.long_name;
                    }
                    if (component.types.includes('locality')) {
                        document.getElementById('city').value = component.long_name;
                    }
                });
            });
            
            marker.addListener('dragend', function() {
                const geocoder = new google.maps.Geocoder();
                geocoder.geocode({ location: marker.getPosition() }, function(results, status) {
                    if (status === 'OK' && results[0]) {
                        document.getElementById('full-address').value = results[0].formatted_address;
                    }
                });
            });
        }
        
        function locateUser() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    const pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    map.setCenter(pos);
                    marker.setPosition(pos);
                    
                    const geocoder = new google.maps.Geocoder();
                    geocoder.geocode({ location: pos }, function(results, status) {
                        if (status === 'OK' && results[0]) {
                            document.getElementById('full-address').value = results[0].formatted_address;
                            
                            results[0].address_components.forEach(component => {
                                if (component.types.includes('postal_code')) {
                                    document.getElementById('postal-code').value = component.long_name;
                                }
                                if (component.types.includes('locality')) {
                                    document.getElementById('city').value = component.long_name;
                                }
                            });
                        }
                    });
                }, function() {
                    alert('Location access denied. Please enter your address manually.');
                }, { timeout: 10000 });
            } else {
                alert('Your browser does not support geolocation.');
            }
        }
        
        function verifyPostalCode() {
            const postalCode = document.getElementById('postal-code').value.trim();
            const statusElement = document.getElementById('postal-code-status');
            
            if (!postalCode) {
                statusElement.innerHTML = '<span class="text-danger">Please enter a postal code.</span>';
                return false;
            }
            
            statusElement.innerHTML = '<span class="text-warning">Verifying...</span>';
            
            // Simulate API call
            setTimeout(() => {
                // In production, this would be a real API call
                const isValid = /^\d{5}(-\d{4})?$/.test(postalCode); // US ZIP code pattern
                
                if (isValid) {
                    statusElement.innerHTML = '<span class="text-success"><i class="fas fa-check-circle me-1"></i>Valid postal code. Delivery available.</span>';
                    return true;
                } else {
                    statusElement.innerHTML = '<span class="text-danger"><i class="fas fa-times-circle me-1"></i>Invalid postal code format.</span>';
                    return false;
                }
            }, 800);
        }
        
        function verifyAddressAndNext() {
            const fullName = document.getElementById('full-name').value.trim();
            const phone = document.getElementById('phone-number').value.trim();
            const email = document.getElementById('email-address').value.trim();
            const address = document.getElementById('full-address').value.trim();
            const city = document.getElementById('city').value;
            const postalCode = document.getElementById('postal-code').value.trim();
            
            const alertElement = document.getElementById('address-alert');
            
            if (!fullName || !phone || !email || !address || !city) {
                alertElement.textContent = 'Please fill all required fields correctly.';
                alertElement.style.display = 'block';
                return false;
            }
            
            // Validate phone
            const phoneRegex = /^[\+]?[1-9][\d]{0,15}$/;
            if (!phoneRegex.test(phone.replace(/[\s\-\(\)]/g, ''))) {
                alert('Please enter a valid phone number.');
                return false;
            }
            
            // Validate email
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert('Please enter a valid email address.');
                return false;
            }
            
            selectedAddress = {
                fullName,
                phone,
                email,
                address,
                city,
                postalCode,
                coordinates: marker.getPosition().toJSON()
            };
            
            alertElement.style.display = 'none';
            nextStep(3);
            return true;
        }
        
        function loadAddressSection() {
            if (selectedAddress) {
                document.getElementById('full-name').value = selectedAddress.fullName;
                document.getElementById('phone-number').value = selectedAddress.phone;
                document.getElementById('email-address').value = selectedAddress.email;
                document.getElementById('full-address').value = selectedAddress.address;
                document.getElementById('city').value = selectedAddress.city;
                document.getElementById('postal-code').value = selectedAddress.postalCode;
                
                if (selectedAddress.coordinates) {
                    const pos = selectedAddress.coordinates;
                    map.setCenter(pos);
                    marker.setPosition(pos);
                }
            }
        }
        
        // Delivery Options
        function loadDeliverySection() {
            if (selectedAddress) {
                document.getElementById('selected-address-display').textContent = 
                    `${selectedAddress.address}, ${selectedAddress.city}`;
                
                const distance = calculateDistance(selectedAddress.city);
                document.getElementById('distance-display').textContent = `Distance: ${distance} km`;
                updateDeliveryPrices(distance);
            }
            
            const itemCount = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            const totalWeight = cartItems.reduce((sum, item) => sum + (item.weight * item.quantity), 0);
            const totalPrice = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            document.getElementById('item-count').textContent = itemCount;
            document.getElementById('total-weight').textContent = `${totalWeight.toFixed(1)} kg`;
            document.getElementById('total-price-display').textContent = `$${totalPrice.toFixed(2)}`;
        }
        
        function calculateDistance(city) {
            const distances = {
                'new-york': 5,
                'london': 100,
                'dubai': 200,
                'toronto': 150,
                'sydney': 300,
                'other': Math.floor(Math.random() * 200) + 50
            };
            return distances[city] || 100;
        }
        
        function updateDeliveryPrices(distance) {
            const baseStandard = 9.99;
            const baseExpress = 19.99;
            const baseSameDay = 29.99;
            
            const multiplier = 1 + (distance / 1000);
            
            document.getElementById('standard-price').textContent = 
                `$${(baseStandard * multiplier).toFixed(2)}`;
            document.getElementById('express-price').textContent = 
                `$${(baseExpress * multiplier).toFixed(2)}`;
            document.getElementById('same-day-price').textContent = 
                `$${(baseSameDay * multiplier).toFixed(2)}`;
        }
        
        function selectDeliveryOption(option) {
            event.stopPropagation();
            const selectedEl = event.currentTarget;
            
            document.querySelectorAll('.delivery-option').forEach(el => {
                el.classList.remove('selected');
                el.querySelector('input[type="radio"]').checked = false;
            });
            
            selectedEl.classList.add('selected');
            selectedEl.querySelector('input[type="radio"]').checked = true;
            selectedDelivery = option;
            
            updateOrderSummary();
        }
        
        function calculateDeliveryAndNext() {
            if (!selectedDelivery) {
                alert('Please select a delivery method.');
                return false;
            }
            
            nextStep(4);
            return true;
        }
        
        // Payment Methods
        function detectUserCountry() {
            // Simulated country detection
            const countries = ['US', 'UK', 'CA', 'AU', 'AE', 'PK', 'IN', 'BD'];
            userCountry = countries[Math.floor(Math.random() * countries.length)];
            
            const countryNames = {
                'US': 'United States',
                'UK': 'United Kingdom',
                'CA': 'Canada',
                'AU': 'Australia',
                'AE': 'UAE',
                'PK': 'Pakistan',
                'IN': 'India',
                'BD': 'Bangladesh'
            };
            
            document.getElementById('user-country').textContent = 
                countryNames[userCountry] || userCountry;
            
            localStorage.setItem('userCountry', userCountry);
        }
        
        function updatePaymentMethods() {
            // Show payment methods based on country
            const stripeOption = document.getElementById('stripe-option');
            const razorpayOption = document.getElementById('razorpay-option');
            
            // Hide all first
            if (stripeOption) stripeOption.style.display = 'none';
            if (razorpayOption) razorpayOption.style.display = 'none';
            
            // Show based on country
            if (['US', 'UK', 'CA', 'AU', 'EU'].includes(userCountry)) {
                // Stripe for western countries
            }
            
            if (['IN'].includes(userCountry)) {
                // Razorpay for India
            }
            
            // Update available methods text
            const methodText = getAvailableMethodsText();
            document.getElementById('available-methods').textContent = methodText;
        }
        
        function getAvailableMethodsText() {
            const methods = ['Credit/Debit Card', 'PayPal', 'Apple Pay', 'Google Pay', 'Bank Transfer'];
            
            if (['US', 'UK', 'CA', 'AU', 'EU'].includes(userCountry)) {
                methods.push('Stripe');
            }
            
            if (['IN'].includes(userCountry)) {
                methods.push('Razorpay');
            }
            
            if (['BD'].includes(userCountry)) {
                methods.push('SSLCommerz');
            }
            
            if (['PK', 'AE', 'SA'].includes(userCountry)) {
                methods.push('Cash on Delivery');
            }
            
            return methods.join(', ');
        }
        
        function selectPaymentMethod(method) {
            event.stopPropagation();
            const selectedEl = event.currentTarget;
            
            document.querySelectorAll('.payment-method').forEach(el => {
                el.classList.remove('selected');
                el.querySelector('input[type="radio"]').checked = false;
            });
            
            selectedEl.classList.add('selected');
            selectedEl.querySelector('input[type="radio"]').checked = true;
            selectedPayment = method;
            
            // Show/hide details
            document.getElementById('card-details').style.display = 
                method === 'card' ? 'block' : 'none';
            document.getElementById('bank-details').style.display = 
                method === 'bank' ? 'block' : 'none';
            document.getElementById('cod-info').style.display = 
                method === 'cod' ? 'block' : 'none';
        }
        
        function validateCardDetails() {
            const cardNumber = document.getElementById('card-number').value.replace(/\s/g, '');
            const cardExpiry = document.getElementById('card-expiry').value;
            const cardCVV = document.getElementById('card-cvv').value;
            const cardHolder = document.getElementById('card-holder').value.trim();
            
            if (!/^\d{16}$/.test(cardNumber)) {
                alert('Please enter a valid 16-digit card number.');
                return false;
            }
            
            if (!/^\d{2}\/\d{2}$/.test(cardExpiry)) {
                alert('Please enter expiry date in MM/YY format.');
                return false;
            }
            
            if (!/^\d{3,4}$/.test(cardCVV)) {
                alert('Please enter valid CVV (3 or 4 digits).');
                return false;
            }
            
            if (!cardHolder) {
                alert('Please enter cardholder name.');
                return false;
            }
            
            return true;
        }
        
        function processPayment() {
            if (!selectedPayment) {
                alert('Please select a payment method.');
                return;
            }
            
            if (selectedPayment === 'card' && !validateCardDetails()) {
                return;
            }
            
            // Show processing
            const btn = document.querySelector('#payment-section .btn-success-gradient');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i> Processing...';
            btn.disabled = true;
            
            // Simulate payment processing
            setTimeout(() => {
                processOrder();
                btn.innerHTML = originalText;
                btn.disabled = false;
            }, 2000);
        }
        
        // Order Processing
        function processOrder() {
            // Generate order number
            const orderNumber = 'ORD-' + Date.now().toString().slice(-8);
            document.getElementById('order-number').textContent = orderNumber;
            
            // Update confirmation details
            if (selectedAddress) {
                document.getElementById('confirmed-address').textContent = 
                    `${selectedAddress.address}, ${selectedAddress.city}`;
            }
            
            const deliveryNames = {
                'standard': 'Standard Delivery (5-7 days)',
                'express': 'Express Delivery (2-3 days)',
                'same-day': 'Same Day Delivery (24 hours)'
            };
            document.getElementById('confirmed-delivery').textContent = 
                deliveryNames[selectedDelivery] || selectedDelivery;
            
            const paymentNames = {
                'card': 'Credit/Debit Card',
                'paypal': 'PayPal',
                'applepay': 'Apple Pay',
                'googlepay': 'Google Pay',
                'bank': 'Bank Transfer',
                'cod': 'Cash on Delivery'
            };
            document.getElementById('confirmed-payment').textContent = 
                paymentNames[selectedPayment] || selectedPayment;
            
            // Generate tracking
            const trackingNumber = 'TRK-' + Math.random().toString(36).substr(2, 10).toUpperCase();
            document.getElementById('tracking-number').textContent = trackingNumber;
            
            // Calculate delivery date
            const estimatedDate = new Date();
            const deliveryDays = {
                'standard': 7,
                'express': 3,
                'same-day': 1
            };
            estimatedDate.setDate(estimatedDate.getDate() + (deliveryDays[selectedDelivery] || 5));
            
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('estimated-delivery').textContent = 
                estimatedDate.toLocaleDateString('en-US', options);
            
            // Update total
            document.getElementById('confirmed-total').textContent = 
                document.getElementById('grand-total').textContent;
            
            // Move to confirmation
            nextStep(5);
            
            // Clear cart
            cartItems = [];
            saveCart();
            updateCartDisplay();
            
            // Send notifications
            sendOrderNotifications(orderNumber, trackingNumber);
            integrateWithDeliveryPartners(orderNumber, trackingNumber);
        }
        
        function sendOrderNotifications(orderNumber, trackingNumber) {
            console.log(`Order ${orderNumber} confirmed. Tracking: ${trackingNumber}`);
            
            if (selectedAddress && selectedAddress.email) {
                console.log(`Confirmation email sent to: ${selectedAddress.email}`);
            }
            
            if (selectedAddress && selectedAddress.phone) {
                console.log(`SMS sent to: ${selectedAddress.phone}`);
            }
        }
        
        function integrateWithDeliveryPartners(orderNumber, trackingNumber) {
            const partners = ['FedEx', 'UPS', 'DHL'];
            const selectedPartner = partners[Math.floor(Math.random() * partners.length)];
            
            console.log(`Order ${orderNumber} assigned to ${selectedPartner}. Tracking: ${trackingNumber}`);
        }
        
        // Order Summary
        function updateOrderSummary() {
            const subtotal = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            const tax = subtotal * 0.10; // 10% tax
            const deliveryCharge = getDeliveryCharge();
            const grandTotal = subtotal + tax + deliveryCharge;
            
            orderTotal = grandTotal;
            
            document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
            document.getElementById('tax').textContent = `$${tax.toFixed(2)}`;
            document.getElementById('delivery-charge').textContent = `$${deliveryCharge.toFixed(2)}`;
            document.getElementById('grand-total').textContent = `$${grandTotal.toFixed(2)}`;
            
            // Update order summary items
            const summaryContainer = document.getElementById('order-summary-items');
            summaryContainer.innerHTML = '';
            
            cartItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'summary-item';
                div.innerHTML = `
                    <span>${item.name} x${item.quantity}</span>
                    <span>$${(item.price * item.quantity).toFixed(2)}</span>
                `;
                summaryContainer.appendChild(div);
            });
            
            // Add items count
            const itemCount = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            const countDiv = document.createElement('div');
            countDiv.className = 'summary-item';
            countDiv.innerHTML = `
                <span>Items (${itemCount}):</span>
                <span>$${subtotal.toFixed(2)}</span>
            `;
            summaryContainer.prepend(countDiv);
            
            // Enable/disable place order button
            const placeOrderBtn = document.getElementById('place-order-btn');
            placeOrderBtn.disabled = cartItems.length === 0;
        }
        
        function getDeliveryCharge() {
            if (!selectedDelivery) return 0;
            
            const priceElement = document.getElementById(`${selectedDelivery}-price`);
            if (priceElement) {
                const match = priceElement.textContent.match(/\$([\d.]+)/);
                return match ? parseFloat(match[1]) : 0;
            }
            return 0;
        }
        
        // Validation
        function validateCurrentStep() {
            switch(currentStep) {
                case 1:
                    if (cartItems.length === 0) {
                        alert('Your cart is empty. Please add items to continue.');
                        return false;
                    }
                    return true;
                case 2:
                    return verifyAddressAndNext();
                case 3:
                    if (!selectedDelivery) {
                        alert('Please select a delivery method.');
                        return false;
                    }
                    return true;
                case 4:
                    if (!selectedPayment) {
                        alert('Please select a payment method.');
                        return false;
                    }
                    return true;
                default:
                    return true;
            }
        }
        
        // Utility Functions
        function placeOrder() {
            if (cartItems.length === 0) {
                alert('Your cart is empty.');
                return;
            }
            
            nextStep(4);
        }
        
        function printOrder() {
            window.print();
        }
        
        function trackOrder() {
            const trackingNumber = document.getElementById('tracking-number').textContent;
            alert(`Your tracking number: ${trackingNumber}\n\nVisit our website or contact us to track your order.`);
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
                if (currentStep === 1) nextStep(2);
                else if (currentStep === 2) verifyAddressAndNext();
                else if (currentStep === 3) calculateDeliveryAndNext();
                else if (currentStep === 4) processPayment();
            }
        });
        
        // Initialize quantity inputs
        document.addEventListener('input', function(e) {
            if (e.target.classList.contains('quantity-input')) {
                const value = parseInt(e.target.value);
                if (isNaN(value) || value < 1) {
                    e.target.value = 1;
                }
            }
        });
    </script>
</body>
</html>
